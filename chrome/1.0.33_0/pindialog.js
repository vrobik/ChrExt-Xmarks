var xm_callback=null,xm_action=null,xm_PinCheck=null;
function HandleAction(a){if(!xm_action){xm_action=a;var b={hasPin:!1};if("pin"==a){a=chrome.extension.getBackgroundPage();if(!xm_PinCheck(document.getElementById("pin").value))return document.getElementById("pin-error").innerHTML=chrome.i18n.getMessage("pindialog_error"),document.getElementById("pin-error").style.display="block",xm_action=null,!1;b={hasPin:!0,encodedPin:a.Base64.encode(document.getElementById("pin").value),persist:document.getElementById("remember-pin").checked}}xm_callback(top,b)}}
function HandleLoad(){LoadLocalizedStrings();var a=chrome.extension.getBackgroundPage().Xmarks.Settings.GetWindowParams();document.getElementById("pin").focus();a&&(xm_callback=a.callback,xm_PinCheck=a.pinConfirmCallback)}
function LoadLocalizedStrings(){document.title=chrome.i18n.getMessage("pindialog_title");document.getElementById("pin-title").innerHTML=chrome.i18n.getMessage("pindialog_title");document.getElementById("pin-message-pin").innerHTML=chrome.i18n.getMessage("pindialog_pin");document.getElementById("pin-button-cancel").value=chrome.i18n.getMessage("dialog_cancel")}
function HidePinError(){"none"!=document.getElementById("pin-error").style.display&&(document.getElementById("pin-error").style.display="none")}
document.addEventListener("DOMContentLoaded",function(){window.addEventListener("load",function(){HandleLoad()});window.addEventListener("unload",function(){HandleAction("cancel")});document.getElementById("xmform").onsubmit=function(){HandleAction("pin")};document.getElementById("pin").addEventListener("focus",function(){HidePinError()});document.getElementById("pin-button-login").addEventListener("click",function(){HandleAction("pin")});document.getElementById("pin-button-cancel").addEventListener("click",
function(){HandleAction("cancel")})});
